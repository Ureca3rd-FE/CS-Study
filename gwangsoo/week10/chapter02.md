# TLS/SSL HandShake

HTTPS에서 클라이언트와 서버간 통신 전 SSL 인증서로 신뢰성 여부를 판단하기 위해 연결하는 방식이다.

## 진행 순서

### 1. Client Hello

- 클라이언트가 서버로 **Client Hello 메시지** 전송
- 지원하는 **TLS 버전, 암호 알고리즘, 압축 방식**, 난수 등을 포함

### 2. Server Hello + 서버 인증서 전송

- 서버는 클라이언트의 제안을 기반으로 사용할 **암호 알고리즘/압축 방식**을 선택
- **세션 ID**와 함께 **CA가 서명한 서버 인증서**를 전달
- 인증서 안에는 서버의 **공개키**가 포함되어 있음

### 3. 클라이언트의 서버 인증서 검증

- 클라이언트는 인증서가 신뢰 가능한 CA에서 발급되었는지 확인
- **도메인 일치 여부**, **만료 여부**, **서명 유효성**을 검증

### 4. 난수 생성 및 전송

- 인증서가 신뢰되면 클라이언트는 **난수** 를 생성
- 이를 서버의 **공개키로 암호화**하여 서버로 전송
- 이 값은 이후 **대칭키(세션 키) 생성**에 사용됨

### 5. 클라이언트 인증 요청 대응

- 서버가 클라이언트 인증을 요구한 경우 클라이언트 인증서 + 클라이언트 개인키로 서명한 임의 데이터를 함께 전송

### 6. 서버 측에서 난수 복호화

- 서버는 자신의 **개인키로 난수 복호화**
- 클라이언트와 동일한 방식으로 **대칭 마스터 키(세션 키)** 를 생성

### 7. 클라이언트의 Finished 메시지 전송

- 클라이언트는 지금까지의 교환 내역을 **해싱**
- 이 해시 값을 **세션 키로 암호화**하여 **Finished 메시지**로 전송
- “핸드셰이크 단계 끝났음”을 알리는 신호

### 8. 서버의 Finished 메시지 응답

- 서버도 동일하게 교환 내역을 해싱
- 클라이언트가 보낸 해시와 일치하는지 확인
- 자신도 **Finished 메시지를 세션 키로 암호화**하여 클라이언트에게 전송

### 9. 보안 통신 시작

- 클라이언트가 서버의 Finished 메시지를 복호화하여 검증 성공
- 이제 양측 모두 동일한 **대칭키**를 보유
- 이후 모든 요청, 응답은 이 **대칭키 기반 암호화**로 안전하게 전송됨

## 참고

- [HTTPS 통신과정 쉽게 이해하기 #3(SSL Handshake, 협상)](https://aws-hyoh.tistory.com/39)
