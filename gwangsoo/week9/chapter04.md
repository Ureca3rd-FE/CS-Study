# UDP

- **비연결형**, **신뢰성 없는** 전송 프로토콜
- 데이터를 **데이터그램 단위**로 전송하는 전송 계층 프로토콜
- 연결 설정이 없고 오류 복구 기능도 없다 → 매우 빠름

## TCP와 UDP가 등장하게 된 이유

### 1) IP의 한계 (Host-to-Host만 가능)

IP는 **장치 간 통신(Host to Host)** 만 담당한다.  
하지만 하나의 장비 안에는 여러 프로그램(프로세스)이 존재하므로 **프로세스 간 통신(Process to Process)** 을 위해 **포트 번호**가 필요하다.

### 2) 오류 처리의 한계

IP 오류는 ICMP가 알려주지만 ICMP는 **알려주기만 하고 복구는 못한다.**  
따라서 IP 상위 계층에서 오류 처리 기능이 필요했고 **TCP와 UDP가 등장**했다.

> **ICMP** : 인터넷 제어 메시지 프로토콜 – 네트워크 오류를 알려주는 역할

## TCP와 UDP는 어떻게 오류를 해결하는가?

### TCP

- 데이터 **손실, 중복, 순서 뒤바뀜**을 자동으로 복구
- 재전송, 순서정렬, 흐름제어, 혼잡제어 지원 → **신뢰성 높은 연결 지향형 프로토콜**

### UDP

- IP 수준의 최소 기능만 제공
- 오류 검출은 가능하지만 **복구는 하지 않음**
- 순서 보장 X, 재전송 X → 필요하면 **애플리케이션 레벨에서 직접 처리**해야 함

## UDP는 왜 사용할까?

- **가장 큰 장점 = 빠르다(낮은 지연, Overhead 거의 없음)**
- 연결 설정 과정(3-Way Handshake)이 없어서 즉시 전송 가능
- 실시간성이 중요한 서비스에서 필수

### 사용 예

- 온라인 게임
- 실시간 스트리밍
- VoIP(음성 통화), 화상회의

> 예: 통신이 잠깐 끊겨도 전체를 재전송하면 오히려 더 느려짐 → UDP 선호

## DNS(Domain Name Service)가 UDP를 사용하는 이유

- DNS 요청의 크기가 작아서 **UDP 데이터그램 안에 충분히 담김**
- 연결 설정이 필요 없어 **빠른 요청/응답 가능**
- 재전송 필요 시 애플리케이션 계층에서 직접 처리 가능
- 기본 포트: **53번**

### 예외적으로 DNS가 TCP를 사용하는 경우

- DNS 응답 크기가 **512바이트 초과**할 때 (UDP 한계)
- 영역 전송(Zone Transfer) 같은 중요한 데이터 전송 시

## 1. UDP Header

![udp-header](./assets/udp-header.png)

UDP 헤더는 매우 단순하며 다음 4개의 필드로 구성된다.

- **Source Port** : 송신 포트 번호
- **Destination Port** : 수신 포트 번호
- **Length** : UDP 헤더 + 데이터 전체 길이
- **Checksum** : 오류 검출용 값
  - 단순한 오류 검출 방식으로 데이터 무결성을 확인하지만 오류 복구는 하지 않음

UDP 헤더는 구조가 단순하기 때문에 **TCP보다 훨씬 가볍고 빠른 전송이 가능하다.**  
하지만 **확인 응답(ACK)이 없으므로 TCP보다 신뢰성은 떨어진다.**

- UDP = 비연결성 (connectionless)
- TCP = 연결성 (connection-oriented)

## DNS가 UDP를 사용하는 이유

DNS는 기본적으로 **데이터를 조회하는 Application Layer 프로토콜**이다.  
Application Layer 프로토콜은 TCP 또는 UDP 중 하나를 선택하여 사용해야 한다.

DNS는 정확해 보이지만 **대부분의 요청이 매우 작고 단순한 조회이기 때문에  
UDP 사용이 더 적절**하다.

### UDP를 사용하는 이유

1. **연결 유지가 필요 없다**

   - TCP는 3-Way Handshake 필요
   - UDP는 연결 설정 없이 바로 전송 → 지연 감소

2. **DNS 요청/응답 크기가 작다**

   - 대부분의 DNS 조회는 UDP 데이터그램 안에 충분히 담긴다

3. **빠른 왕복 속도 중요**

   - DNS는 웹 브라우징 등 모든 네트워크 요청의 시작이므로 빠른 처리 속도가 중요함

4. **신뢰성은 상위 계층에서 보완 가능**

   - UDP는 not reliable이지만 Application Layer에서 재전송, 타임아웃 등을 직접 구현 가능

5. **프로토콜 오버헤드가 작다**
   - DNS는 단순 요청/응답이기 때문에 오버헤드가 적은 UDP가 적합

## DNS에서 TCP를 사용하는 경우

기본적으로 DNS는 UDP 53번 포트를 사용하지만 다음과 같은 상황에서는 TCP를 사용해야 한다.

1. **Zone Transfer 수행 시**

   - DNS 서버 간 데이터 복제는 큰 데이터를 주고받기 때문에 TCP 필요

2. **데이터 크기가 512 bytes 초과할 때**

   - UDP 데이터그램 한계 → TCP로 재전송

3. **UDP로 요청을 보냈지만 응답이 없을 때**
   - 신뢰성을 위해 TCP로 재시도
