# 7주차 🛅데이터베이스

## Chap06. 저장 프로시저 (Stored Procedure)

### #1. 저장 프로시저란?

#### 개념

- SQL을 단순히 쿼리문으로 사용하는 수준은 넘어, 조건문/반복문 등 로직을 포함할 수 있는 프로그램형 SQL 블록
- 여러 SQL문을 하나의 논리 단위로 묶어, 데이터베이스에 저장해 두고 필요할 때마다 호출하여 실행할 수 있는 프로그램 객체 (실행 단위)
  - 자주사용하는 SQL로직(조회, 삽입, 수정, 삭제 등)을 DB 내부에 저장하여 함수처럼 재사용할 수 있게 만든 것
  - 한 번의 요청으로 프로시저 내 모든 SQL 블록이 순차적으로 실행됨

#### 코드 예시

```sql
-- 구조
DELIMITER $$      -- (1) 구분자 $$로 변경

CREATE PROCEDURE add_user(IN p_name VARCHAR(50), IN p_age INT)
BEGIN
  INSERT INTO users(name, age) VALUES (p_name, p_age);
  UPDATE users SET age = p_age WHERE name = p_name;
END $$            -- (2) $$를 만나야 명령이 끝났다고 인식함

DELIMITER ;       -- (3) 구분자 ;로 복구

-- 호출
CALL add_user('홍길동', 25);
```

- DELIMITER (구분자 변경)
  - 기본적으로 MySQL은 ;를 명령의 종료로 인식
  - 저장 프로시저 내부에는 여러 SQL문이 포함되므로 ; 대신 $$, // 등의 다른 구분자를 임시로 지정해야 함

---

### #2. 저장 프로시저의 특징

#### 장점

- SQL 실행 속도 향상: 저장 시점에 미리 컴파일 됨
- 네트워크 트래픽 감소: 로직이 DB 내부에서 처리
- 코드 재사용성 높음
- 비즈니스 로직 보안 강화

#### 단점

- DB 종속성 증가: DBMS마다 문법/호환성 다름
- 버전 관리 어려움
- 로직이 복잡할 수록, 유지보수가 어려워짐
- 서버 애플리케이션 코드(서버 쪽 프로그램 코드)와 중복될 가능성 생김
