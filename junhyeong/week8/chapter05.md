# 7주차 🛅데이터베이스

## Chap05. Redis (Remote Dictionary Server)

### #1. Redis란?

#### 개념

- 인메모리 기반의 Key-Value 데이터 저장소
- 데이터를 디스크가 아닌 **메모리(RAM)**에 저장하여 **빠른 데이터 접근 속도를 제공**
- 단순한 캐시 서버를 넘어서 **DB**, **캐시**, **메세지 브로커** 역할도 수행하는 **비관계형(NoSQL) 데이터베이스** (고성능 데이터 저장소)

#### 용어

- DB: 데이터를 영구적으로 저장하고 관리하는 시스템
- 캐시: 자주 사용되는 데이터를 임시적으로 저장하여 접근 속도를 높이는 메모리 공간
- 메세지 브로커: 시스템 간 데이터를 비동기적으로 전달하고 중개하는 소프트웨어
  - 동기적 통신: 송신자가 메세지를 보내면, 수신자가 메세지를 처리하고 응답할 때까지 기다림
  - 비동기적 통신: 송신자는 메세지를 보내고 즉시 다음 작업을 진행. 수신자는 중간 매개체(메세지 브로커)에 저장된 메세지를 나중에 꺼내어 처리.

---

### #2. Redis의 주요 특징

#### 1. 메모리 기반 저장 (In-memory Storage)

- 모든 데이터를 RAM에 저장하여 읽기/쓰기 속도가 매우 빠름
- ms 이하 응답 속도 제공 -> 디스크 I/O 병목이 없기 때문

#### 2. Key-Value 구조

- 모든 데이터는 key와 value 쌍으로 저장
- value는 문자열, List, Set, Hash, Bitmap, Stream 등 다양한 자료구조 지원

#### 3. 영속성 보장 (Persistence)

- 여기서 나오는 의문점: RAM은 휘발성 메모리라서, 저장 공간으로 사용하면 데이터 손실이 발생하지 않을까?
- 의문점 해소: 데이터 손실 방지를 위해 **디스크 백업 기능 제공**
- RDB(Redis Database Backup): 주기적으로 전체 스냅샷을 디스크에 저장
- AOF(Append Only File): 모든 명령어를 로그로 기록하여 장애 발생 시 복구

#### 4. Single-thread Architecture

- Redis는 단일 스레드 기반 동작
- 메모리 기반 + 논블로킹 I/O 구조로 인해 고성능 처리 가능
- 동시성 제어를 단순화하여 데이터 일관성 유지에 용이

#### 5. Pub/Sub (발행-구독 모델) 지원

- 메세지 브로커 역할 수행 가능
- Publisher가 채널로 메세지 보내면 Subscriber들이 실시간으로 수신

#### 6. Replication & Cluster (복제 및 분산 처리)

- Master-Slave 구조로 데이터 복제 가능
- Redis Cluster 기능을 통해 데이터를 여러 노드에 분산 저장 -> 수평 확장성 확보

#### Redis의 장단점

- 장점
  - 매우 빠른 속도 + 간단한 사용
  - 다양한 자료구조
  - 캐시/브로커 겸용
- 단점
  - 메모리 용량 한정
  - 데이터 크기가 커질 시 비용 부담 증가
  - 단일 스레드 한계

---

### #3. Redis 동작 과정

#### 1. Client -> Redis Server

- TCP 연결 + RESP 프로토콜로 명령 전송
- Redis는 단일 스레드 이벤트 루프로 소켓에서 읽기/파싱/커맨드를 큐잉
  - 큐잉: 명령을 순서대로 내부 큐에 넣고, 하나씩 꺼내어 큐 방식으로 처리
- 단일 스레드지만 메모리 기반 + 논블로킹 I/O라 매우 빠름

#### 2. 메모리 내 데이터 조작 (Key-Value)

- 커맨드가 실행되어 메모리의 자료구조가 수정/조회 됨
- 읽기 명령은 메모리만 읽고, 쓰기 명령은 메모리를 변경함
- 결과는 즉시 클라이언트에게 응답

#### 3. 명령 로그 기록 (AOF)

- 쓰기 명령만 실행 후 AOF 파일 끝에 원문 명령으로 append
  - 쓰기 명령 수행 후 AOF 파일에 해당 명령을 추가
  - 읽기 명령은 기록 X
- 시간이 지나 AOF가 커지면, AOF rewrite로 현재 메모리 상태를 기준으로 필요한 최소 명령 집합만 남기고 다시 작성 -> 파일 크기 감소 + 복구 속도 향상

#### 4. 주기적 스냅샷 저장 (RDB)

- 설정된 규칙 또는 명령에 의해 포크한 자식 프로세스가 메모리 스냅샷 통째로 RDB파일로 기록
- RDB는 특정 시점의 전체 상태를 빠르게 복구 가능 + 파일이 작아 백업/전송에 용이

#### 5. Disk (Persistence)

- AOF 파일과 RDB 파일이 디스크에 존재
- 재시작 시 복구순서: AOF 우선, 없으면 RDB로 복구
- AOF + RDB 동시 사용 가능: RDB로 빠른 베이스라인 + AOF로 최근 변경 누적
  - 베이스라인: 복구 시 기준이 되는 시점
  - AOF로 RDB 이후의 최신 상태를 반영

---

### #4. 활용 사례

- **캐시**: DB 조회 결과를 캐싱하여 응답 속도 향상
- **세션 관리**: 로그인 세션을 Redis에 저장하여 서버 간 공유
- **Ranking/Leaderboard**: Sorted Set 구조로 실시간 랭킹 구현
- **메세지 큐/Pub-Sub**: 실시간 알림, 채팅 서버 구현
- **분산 락**: 여러 서버 간 공유 자원 접근 제어
