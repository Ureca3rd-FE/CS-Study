# 7주차 🛅데이터베이스

## Chap03. SQL Injection

### #1. SQL Injection이란?

#### 개념

- 사용자 입력값 검증이 미흡할 때 주로 발생
- 공격자가 악의적인 SQL 코드를 포함한 입력값을 주입하는 공격 방식을 의미

#### 특징

- 데이터베이스 명령을 조작, 원치 않는 명령을 실행하여 악의적인 행위를 수행 (데이터 유출/변조, 관리자 권한 탈취 등)
- 주로 웹 애플리케이션에서 발생 (데이터베이스와 상호작용하는 모든 시스템에서 발생 가능)

---

### #2. 공격 방법

#### 1. 인증 우회 (Classical/Boolean-based SQL Injection)

- 개념
  - 쿼리의 WHERE 조건을 조작하여 항상 참이 되도록 하거나 인증 절차를 우회
  - 접근 제어를 무력화하여 권한 없이 접근이 가능함
- 예시 코드
  ```sql
  ' OR 1=1 --
  ```

#### 2. 직접 데이터 노출(Union based/Error-based SQL Injection)

- 개념
  - UNION SELECT 혹은 오류 메세지를 유도하여 내부 구조를 파악하는 방식
  - DB 테이블/컬럼 값을 그대로 화면에 노출하여 민감정보가 바로 탈취됨
- 예시 코드
  ```sql
  1 UNION SELECT username, password FROM users --
  ```

#### 3. 비가시적 추출 (Time-based SQL Injection)

- 개념
  - 응답의 참/거짓 혹은 지연으로 한 글자씩 데이터를 추출
  - 화면에 보이지 않아도 장기간에 걸쳐 민감정보 탈취 가능
- 예시 코드
  ```sql
  ' OR IF(SUBSTRING((SELECT password FROM users WHERE id=1),1,1)='a', SLEEP(5), 0) --
  ```

---

### #3. 방어 방법

#### 1. 파라미터화된 쿼리 (Prepared Statements/바인딩)

- 개념: 쿼리 주고와 데이터를 분리 -> 입력이 SQL 문법으로 해석되지 않게 함
- 의의: SQL Injection을 근본적으로 차단

#### 2. 최소 권한 원칙 (DB 계정 권한 제한)

- 개념: 애플리케이션이 사용하는 DB 계정에 필요한 권한(읽기, 쓰기 등)만 부여 + 관리자 권한 금지
- 의의: SQL Injection이 발생해도 피해범위를 크게 줄임

#### 3. 입력 검증 + 에러 메세지 일반화

- 개념
  - 입력값을 허용값으로 제한 + 내부 에러/쿼리 정보를 사용자에게는 숨김
  - 이상 행위는 중앙 로그로 수집
  - 에러 메세지를 "500: 서버 오류"로 통일
- 의의: 파라미터화로 막지 못하는 경우(ORM raw SQL)나 논리적 취약을 보완함 (탐지 및 대응)
