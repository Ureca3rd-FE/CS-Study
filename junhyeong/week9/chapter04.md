# 9주차 🛜네트워크

## Chap04. UDP

### #1. UDP 통신이란?

#### 개념

- User Datagram Protocol의 약자: 데이터를 데이터그램 단위로 처리하는 프로토콜
- 비연결형: 연결 설정(3-way handshake)이 없음
- 신뢰성이 없는 방식: 재전송, 순서 보장, 흐름 제어 없음
- 데이터그램 단위로 쪼개어 전송을 해야하므로 전송 계층임 (OSI 4계층)

#### TCP와 UDP의 필요성

- IP는 장치 간(호스트 간) 데이터를 전달하는 역할만 담당
- IP의 한계점
  - 장비 내에서 수많은 프로그램들이 통신하는 경우에는 IP로는 한계가 있음 (구분해서 처리하기 어려움)
  - IP에서 오류 발생 시 ICMP을 통해 알려줄 수 있지만, 대처를 못함 (오류 복구, 재전송, 흐름 제어 등)
- 따라서 포트 번호와 오류 제어 방식을 제공하는 TCP, UDP와 같은 상위 계층의 프로토콜이 필요해짐

#### 오류 해결 방법

- TCP: 데이터의 분실, 중복, 순서 바뀜 등을 보정하여 송수신 데이터의 정확성을 보장함
- UDP: IP가 제공하는 정도의 수준만을 제공하여 오류 발생 시 애플리케이션에서 처리해야함

---

### #2. UDP 구조

#### UDP 헤더

```
UDP 헤더 = [
  ["Source Port (16bit)", "Destination Port (16bit)"],
  ["Length (16bit)", "Checksum (16bit)"]
]
```

- **Source Port (출발지 포트)**

  - 패킷을 보낸 프로세스의 포트 번호
  - 수신측이 응답을 보낼 때 필요
  - UDP도 Request -> Response 구조가 존재 (예 - DNS, DHCP, ...)
  - 응답 불필요 시 0으로 설정

- **Destination Port (목적지 포트)**

  - 패킷을 받는 프로세스의 포트 번호
  - DNS(53), DHCP(67/68) 같이 잘 알려진 포트 번호 사용

- **Length (UDP의 길이)**

  - UDP 헤더 + 데이터(payload)의 전체 길이
  - 패킷의 경계를 판단하는 데 사용

- **Checksum**
  - 데이터의 오류를 검출하는 필드
  - IPv4에서는 선택, IPv6에서는 필수
  - 단순히 손상 여부만 확인 (TCP에서는 오류 복구까지 포함)

#### UDP 메시지 구조

- UDP 세그먼트 전체 길이 = UDP 헤더 + 페이로드(전송 데이터)

- UDP의 데이터그램 특징
  - 독립적인 데이터그램 단위로 전송
  - 각 데이터그램이 독립적 -> 순서 보장 없음
  - 하나의 큰 메시지가 여러 데이터그램으로 쪼개져 보낼 수 있음

#### 포트 번호 기반 다중화/역다중화

- **다중화 (Multiplexing)** - 송신 측 기능

  - 여러 애플리케이션(프로세스)이 동시에 데이터를 전송할 때, 각각의 데이터에 포트 번호를 붙여 하나의 네트워크로 보낼 수 있도록 하는 기능
  - 여러 프로그램이 하나의 네트워크를 통해 통신하더라고 포트 번호를 이용하여 구분 가능

- **역다중화 (Demultiplexing)** - 수신 측 기능
  - 네트워크에서 들어온 UDP 데이터그램을 Destination Port를 기반으로 어떤 애플리케이션에게 전달할지 결정하는 기능
  - 즉, 수신된 데이터그램을 올바른 애플리케이션에게 전달하는 기능

---

### #3. UDP를 사용하는 이유

#### 성능 측면

1. **연결 설정이 없어 지연이 거의 없음**

- TCP: 연결부터 닫기까지 절차가 많음
- UDP: 쏘고 끝(send and forget)이라서 **초저지연**

2. **헤드가 작아 오버헤드가 낮음**

- TCP 헤더: 최소 20바이트
- UDP 헤더: 8바이트

3. **흐름 제어, 혼잡 제어 없음**

- TCP: 혼잡 발생 시 Cwnd 조절로 속도가 떨어짐
- UDP: 네트워크 상태와 무관하게 **일정 속도로 전송 가능**

#### 애플리케이션 요구 측면

- 일부 서비스는 정확성보다 즉시성을 중요하게 여김 (TCP 신뢰성 기능이 오히려 방해됨)

1. **실시간 서비스에서는 지연없는 전송이 중요**

   - 영상, 음성, 게임 같은 서비스에서는 몇 개의 패킷이 유실되더라도 현재 상태가 더 중요
   - TCP처럼 재전송 시 지연 및 끊김 방생
   - 예시: 화상회의, 온라인게임, 실시간 방송 스트리밍, ...

2. **애플리케이션이 자체적으로 보정 가능한 경우**
   - 라이브 스트리밍과 같은 경우, 화면이 계속 보여야함
   - 영상/음성 코덱은 자체적으로 에러 은폐(Error concealment) 기법을 사용해 손실을 보정할 수 있음
   - 이러한 경우 TCP가 제공하는 재전송, 순서 보장이 불필요함
   - 일부 손실을 허용하더라도 실시간성을 더 중요시 함
