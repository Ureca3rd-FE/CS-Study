# ğŸ–²ï¸ìš´ì˜ì²´ì œ 6ì£¼ì°¨

## Chap11. ì„¸ë§ˆí¬ì–´ì™€ ë®¤í…ìŠ¤

### #0. ê²½ìŸ ìƒíƒœì˜ í•´ê²° ë°©ë²•ì˜ ë¶„ë¥˜

#### ê²½ìŸ ìƒíƒœë€?

- ì„ê³„ êµ¬ì—­ : ê³µìœ  ìì›ì— ì ‘ê·¼í•˜ëŠ” ì½”ë“œ êµ¬ì—­
- ê²½ìŸ ìƒíƒœ : ì„ê³„ êµ¬ì—­ì— 2ê°œ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ê°€ ì ‘ê·¼í•˜ì—¬ ì‹¤í–‰ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ëŠ” í˜„ìƒ

- ì„ê³„ êµ¬ì—­ì˜ ì¡°ê±´
  1. ìƒí˜¸ ë°°ì œ (Mutual Exclusion) : í•œ ë²ˆì— í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë§Œ ì„ê³„ êµ¬ì—­ ì‹¤í–‰ ê°€ëŠ¥
  2. í•œì • ëŒ€ê¸° (Bounded Waitting) : ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ë„ ë¬´í•œì • ê¸°ë‹¤ë¦¬ì§€ ì•Šì•„ì•¼ í•¨
  3. ì§„í–‰ (Progress) : í•œ í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„ êµ¬ì—­ì— ìˆì§€ ì•Šì„ ë•Œ, ì§„ì… ëŒ€ê¸° ì¤‘ì¸ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ìˆë‹¤ë©´ ì§„ì…í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

#### ê²½ìŸ ìƒíƒœ í•´ê²° ë°©ë²•ì˜ ë¶„ë¥˜

- ì†Œí”„íŠ¸ì›¨ì–´ì  í•´ê²° ë°©ë²•

  1. í”¼í„°ìŠ¨ ì•Œê³ ë¦¬ì¦˜

     - ê°œë… : ë‘ê°œì˜ í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œê°€ ì„ê³„ êµ¬ì—­ì— ì•ˆì „í•˜ê²Œ ë“¤ì–´ê°€ë„ë¡ í•˜ëŠ” ìƒí˜¸ ë°°ì œ ì•Œê³ ë¦¬ì¦˜
     - íŠ¹ì§•

       - í”„ë¡œì„¸ìŠ¤ê°€ 2ê°œì¼ ë•Œë§Œ ê°€ëŠ¥
       - ë³€ìˆ˜ë§Œìœ¼ë¡œ ë™ì‘ (í•˜ë“œì›¨ì–´ ëª…ë ¹ X)
       - ìƒí˜¸ ë°°ì œ, í•œì •ëŒ€ê¸°, ì§„í–‰ 3ê°€ì§€ ì¡°ê±´ ëª¨ë‘ ì¶©ì¡±

     - ì½”ë“œ ì˜ˆì‹œ

       - turnì˜ ê°’ì€ í”„ë¡œì„¸ìŠ¤ ë²ˆí˜¸ê°€ ì•„ë‹Œ, ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì˜ lockì—¬ë¶€ì— ë”°ë¼ ê¸°ë‹¤ë¦¼ whileë¬¸ì˜ ì‘ë™ ì¡°ê±´ ë°œë™ì‹œí‚¤ê¸° ìœ„í•œ ê°’

       ```
       // ê³µìœ  ë³€ìˆ˜
       boolean lock1 = false;
       boolean lock2 = false;
       int turn = 1;

       // í”„ë¡œì„¸ìŠ¤1
       lock1 = true;
       turn=2;
       while(lock2==true && turn==2);
       /*
       ì„ê³„ êµ¬ì—­
       */
       lock1 = false;

       // í”„ë¡œì„¸ìŠ¤2
       lock2 = true;
       turn=1;
       while(lock1==true && turn==1);
       /*
       ì„ê³„ êµ¬ì—­
       */
       lock2 = false;
       ```

  2. ë°ì»¤ ì•Œê³ ë¦¬ì¦˜

  - ê°œë… : ìµœì´ˆì˜ ìƒí˜¸ ë°°ì œ ì•Œê³ ë¦¬ì¦˜
  - íŠ¹ì§•
    - í”„ë¡œì„¸ìŠ¤ê°€ 2ê°œì¼ ë•Œë§Œ ê°€ëŠ¥
    - ë³€ìˆ˜ë§Œìœ¼ë¡œ ë™ì‘ (í•˜ë“œì›¨ì–´ ëª…ë ¹ X)
  - ì½”ë“œ ì˜ˆì‹œ

    ```
    // ê³µìœ ë³€ìˆ˜
    boolean lock1 = false;
    boolean lock2 = false;
    int turn = 1;

    // í”„ë¡œì„¸ìŠ¤1
    lock1 = true;
    while(lock2==true) {
        if(turn==2) {
            lock1 = false;
            while (turn==2);
            lock1 = true;
        }
    }
    /*
    ì„ê³„ êµ¬ì—­
    */
    turn = 2;
    lock1 = false;

    // í”„ë¡œì„¸ìŠ¤2
    lock2 = true;
    while(lock1==true) {
        if(turn==1) {
            lock2 = false;
            while (turn==1);
            lock2 = true;
        }
    }
    /*
    ì„ê³„ êµ¬ì—­
    */
    turn = 1;
    lock2 = false;
    ```

  3. ë² ì´ì»¤ë¦¬ ì•Œê³ ë¦¬ì¦˜

  - ê°œë…
    - Nê°œì˜ í”„ë¡œì„¸ìŠ¤ê¹Œì§€ í™•ì¥ ê°€ëŠ¥í•œ ìƒí˜¸ ë°°ì œ ì•Œê³ ë¦¬ì¦˜
    - ë¹µì§‘ì˜ ë²ˆí˜¸í‘œ ì‹œìŠ¤í…œì„ ë³¸ëœ¸. ê° í”„ë¡œì„¸ìŠ¤ê°€ ë²ˆí˜¸í‘œë¥¼ ë°›ê³  ë²ˆí˜¸ê°€ ì‘ì€ í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„ êµ¬ì—­ì— ë¨¼ì € ì§„ì…í•˜ëŠ” ë°©ì‹
    - ë™ë“±í•œ ë²ˆí˜¸ì¼ ë•ŒëŠ”, í”„ë¡œì„¸ìŠ¤ ë²ˆí˜¸ë¡œ ìš°ì„ ìˆœìœ„ ê²°ì •
  - íŠ¹ì§•
    - Nê°œì˜ í”„ë¡œì„¸ìŠ¤ê¹Œì§€ í™•ì¥ ê°€ëŠ¥í•œ ìƒí˜¸ ë°°ì œ ì•Œê³ ë¦¬ì¦˜
    - ë³€ìˆ˜ë§Œìœ¼ë¡œ ë™ì‘ (í•˜ë“œì›¨ì–´ ëª…ë ¹ X)
    - ì„ ì…ì„ ì¶œí˜• ë½ êµ¬í˜„ ê°€ëŠ¥
    - ì‹¤ì œ ìš´ì˜ì²´ì œì—ëŠ” ê±°ì˜ ì“°ì´ì§€ ì•ŠìŒ -> ë©”ëª¨ë¦¬ ì¼ê´€ì„± ë³´ì¥ X, CPU ëª…ë ¹ ì›ìì„± ë³´ì¥ X, ...
  - ì½”ë“œ ì˜ˆì‹œ

    ```
    int choosing[n] = {0}; // ë²ˆí˜¸í‘œ ì„ íƒì¤‘ì¸ì§€ í‘œì‹œ
    int number[n] = {0}; // ê° í”„ë¡œì„¸ìŠ¤ì˜ ë²ˆí˜¸í‘œ

    // í”„ë¡œì„¸ìŠ¤i
    choosing[i] = 1;
    number[i] = 1 + max(number[0], ..., number[n-1]);
    choosing[i] = 0;

    for (int j=0; j<n; j++) {
        while (choosing[j]) {/*ëŒ€ê¸°*/}
        while (number[j] != 0 && (number[j] < number[i] ||
       (number[j] == number[i] && j < i))) {
            /* ëŒ€ê¸°: ìì‹ ë³´ë‹¤ ë¨¼ì €ì¸ ë²ˆí˜¸ ìˆìœ¼ë©´ ëŒ€ê¸° */
        }
    }
    /*
    ì„ê³„ êµ¬ì—­
    */
    number[i]= 0; // ë²ˆí˜¸í‘œ ë°˜í™˜

    ```

- í•˜ë“œì›¨ì–´ì  í•´ê²° ë°©ë²•

  1. Test-and-Set ëª…ë ¹ì–´
     - ê°œë…
       - CPUê°€ ì œê³µí•˜ëŠ” ì›ìì (ì¼ë ¨ì˜ ì ˆì°¨ë¥¼ ë™ì‹œì— ìˆ˜í–‰) ëª…ë ¹ì–´
       - lock ë³€ìˆ˜ì˜ "ì½ê¸°"ì™€ "ì“°ê¸°" ì‚¬ì´ì— ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ê°œì…í•  ìˆ˜ ìˆëŠ” ë¬¸ì œ(ì›ìì„± ìœ„ë°˜)ë¥¼ í•˜ë“œì›¨ì–´ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ëª…ë ¹ì–´
     - íŠ¹ì§•
       - í•˜ë‚˜ì˜ ëª…ë ¹ì–´ë¡œ ê°’ì„ ì½ê³ (test) ì¦‰ì‹œ ìˆ˜ì •(set)í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰
       - lock ë³€ìˆ˜ë¥¼ ì½ëŠ” ë„ì¤‘(lock ë³€ìˆ˜ ë³€ê²½ ì „) ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ì ‘ê·¼í•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°
       - ëŒ€ê¸°í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë“¤ì˜ ë°”ìœ ëŒ€ê¸°ë¡œ CPU ë‚­ë¹„
       - ì§„ì…ìˆœì„œë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•„ ê³µì •ì„± ë¬¸ì œ
     -
  2. Swap ëª…ë ¹ì–´
     - ê°œë…
       - ë‘ ë³€ìˆ˜ì˜ ê°’ì„ ì›ìì ìœ¼ë¡œ êµí™˜í•˜ëŠ” ëª…ë ¹ì–´
       - ì „ì—­ ë³€ìˆ˜ì¸ lockê³¼ ì§€ì—­ ë³€ìˆ˜ì¸ key(ê° í”„ë¡œì„¸ìŠ¤ê°€ ê°€ì§)ê°€ ì¡´ì¬
     - íŠ¹ì§•
       - ë°˜ë³µì˜ì‚¬ë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ì˜ key ë³€ìˆ˜ë¥¼ trueë¡œ í• ë‹¹í•˜ê³ , lock ë³€ìˆ˜ì˜ ê°’ê³¼ Swapí•˜ëŠ” ê²ƒì„ ì‹œë„
       - ëŒ€ê¸°í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë“¤ì˜ ë°”ìœ ëŒ€ê¸°ë¡œ CPU ë‚­ë¹„
       - ì§„ì…ìˆœì„œê°€ ê³ ë ¤í•˜ì§€ ì•Šì•„ ê³µì •ì„± ë¬¸ì œ

- ìš´ì˜ì²´ì œì  í•´ê²° ë°©ë²•
  1. ì„¸ë§ˆí¬ì–´ : ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ì˜ ê°œìˆ˜ë¥¼ ìˆ«ìë¡œ ì œí•œí•˜ì—¬ ìì› ì ‘ê·¼ì„ ì œì–´í•˜ëŠ” ë™ê¸°í™” ë„êµ¬
  2. ë®¤í…ìŠ¤ : ì„ê³„ êµ¬ì—­ì— í•œë²ˆì— í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë§Œ ì§„ì…í•˜ë„ë¡ í•˜ëŠ” ìƒí˜¸ ë°°ì œë¥¼ ì‹¤í˜„í•˜ëŠ” ì¥ì¹˜
  3. ëª¨ë‹ˆí„° : ìƒí˜¸ë°°ì œì™€ ì¡°ê±´ ë³€ìˆ˜(ëŒ€ê¸°/ì•Œë¦¼)ë¥¼ ì¶”ìƒí™” ì‹œí‚´.

---

### #1. ì„¸ë§ˆí¬ì–´

- ê°œë…

  - í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„êµ¬ì—­ ì§„ì…í•˜ê¸° ì „ì— ìŠ¤ìœ„ì¹˜ë¥¼ ì‚¬ìš©ì¤‘ìœ¼ë¡œ ë†“ìŒ
  - ê³µìœ  ìì› ì ‘ê·¼ ê°€ëŠ¥í•œ ìŠ¤ë ˆë“œì˜ ê°œìˆ˜ë¥¼ ì œí•œí•˜ëŠ” ë™ê¸°í™” ë„êµ¬ (ì •ìˆ˜í˜• ë³€ìˆ˜)

- ë™ì‘ ê³¼ì •

  - ì •ìˆ˜í˜• ë³€ìˆ˜(RS)ë¥¼ í†µí•´ í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ìì›ì˜ ìˆ˜ë¥¼ ì €ì¥
  - P() - wait() : ì ê¸ˆì„ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œ. RSê°€ 0ë³´ë‹¤ í¬ë©´ 1ê°ì†Œ, 0ë³´ë‹¤ ì‘ìœ¼ë©´ 0ë³´ë‹¤ ì»¤ì§ˆ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼.
  - V() - signal() : ì ê¸ˆ í•´ì œì™€ ë™ê¸°í™”ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œ. RSë¥¼ 1ì¦ê°€ ì‹œí‚¤ê³  ì„¸ë§ˆí¬ì–´ì—ì„œ ê¸°ë‹¤ë¦¬ëŠ” í”„ë¡œì„¸ìŠ¤ì—ê²Œ ì§„ì…í•´ë„ ëœë‹¤ê³  í•˜ëŠ” signalì„ ë³´ëƒ„.

- ì½”ë“œ ì˜ˆì‹œ

  ```
  // N: ì´ˆê¸° ìì› ê°œìˆ˜
  semaphore S = N

  // P ì—°ì‚° (ìì› ì ìœ  ì‹œë„)
  function wait(S):
      while S <= 0:
          wait // ìì› ì—†ìœ¼ë©´ ëŒ€ê¸°
      S -= 1

  // V ì—°ì‚° (ìì› í•´ì œ)
  function signal(S):
      S += 1

  // ì‚¬ìš© ì˜ˆì‹œ
  wait(S)
  /*
  ì„ê³„ êµ¬ì—­ ì‘ì—…
  */
  signal(S)
  ```

- íŠ¹ì§•
  - ë°”ìœ ëŒ€ê¸°ë¥¼ ê·¹ë³µ : ëŒ€ê¸°í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ëŠ” ì‘ì—…ì„ ë§ˆì¹œ í”„ë¡œì„¸ìŠ¤ì—ê²Œì„œ ì‹ í˜¸(wake_up)ë¥¼ ë°›ê¸° ì „ê¹Œì§€ ëŒ€ê¸° íì—ì„œ ëŒ€ê¸° ìƒíƒœ(block) ìœ ì§€
  - ë°”ìœ ëŒ€ê¸°ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° : ì˜›ë‚  ì„¸ë§ˆí¬ì–´ì¸ ê²½ìš° ë°œìƒ. í˜„ëŒ€ ì„¸ë§ˆí¬ì–´ëŠ” ë¸”ë¡œí‚¹ ë°©ì‹.
  - ì„ê³„ êµ¬ì—­ì— ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë“¤ì–´ê°€ë„ ë˜ëŠ” ì´ìœ 
    - ì„ê³„ êµ¬ì—­ ìì²´ê°€ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°
    - ë™ì‹œì— ì ‘ê·¼í•´ë„ ë°ì´í„° ì¶©ëŒì´ ë‚˜ì§€ ì•ŠëŠ” ì„ê³„ êµ¬ì—­ì¸ ê²½ìš°

---

### #2. ë®¤í…ìŠ¤

- ê°œë…

  - ìƒí˜¸ë°°ì œì˜ ì˜ì–´ì¸ Mutual Exclusionì˜ ì•½ì
  - ì¦‰, ìš´ì˜ì²´ì œê°€ ì œê³µí•˜ëŠ” ë½ ë°©ì‹ì˜ ë™ê¸°í™” ë„êµ¬
  - ì„ê³„êµ¬ì—­ì— ì˜¤ì§ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì ê¸ˆì„ ê±°ëŠ” ë°©ì‹

- íŠ¹ì§•
  - ìš´ì˜ì²´ì œì˜ ì»¤ë„ì´ ì œê³µí•˜ëŠ” ë½ ê°ì²´ë¡œ ë™ì‘. ì„ê³„ êµ¬ì—­ ë§ˆë‹¤ í•˜ë‚˜ì˜ ë½ ê°ì²´ê°€ ìˆìŒ
  - ë½ì„ íšë“í•œ í”„ë¡œì„¸ìŠ¤ë§Œ ì„ê³„êµ¬ì—­ì„ ì§„ì…. ë½ì„ í•´ì œí•˜ë©´ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ì§„ì… ê°€ëŠ¥
  - ë½ ì†Œìœ ê¶Œì´ ëª…í™•í•˜ê²Œ êµ¬ë¶„ë¨ : ë½ì„ ê±´ ì£¼ì²´ë§Œì´ ë½ì„ í•´ì œí•  ìˆ˜ ìˆìŒ
  - ì†Œí”„íŠ¸ì›¨ì–´ì  í•´ê²° ë°©ë²•ê³¼ì˜ ì°¨ì´ì 
    - ì†Œí”„íŠ¸ì›¨ì–´ì  í•´ê²°ë°©ë²•ì€ ë®¤í…ìŠ¤ì˜ ì›ë¦¬ë¥¼ ì†Œí”„íŠ¸ì›¨ì–´ì ìœ¼ë¡œ êµ¬í˜„í•œ ê²ƒ
    - ì†Œí”„íŠ¸ì›¨ì–´ì  í•´ê²° ë°©ë²•ì€ ë³€ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì„¤ê³„. ë®¤í…ìŠ¤ëŠ” ìš´ì˜ì²´ì œê°€ ì œê³µí•œ ê°ì²´ë¥¼ ì´ìš©í•˜ì—¬ ë™ì‘.
  - ë°”ìœ ëŒ€ê¸°ì˜ ë°œìƒ ì—¬ë¶€ (êµ¬í˜„ ë°©ì‹ì— ë”°ë¼ ë‹¤ë¦„)
    - ìŠ¤í•€ë½ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ : ë½ ì´ í’€ë¦´ ë•Œê¹Œì§€ whileë¬¸ì—ì„œ ë½ ìƒíƒœë¥¼ ê²€ì‚¬í•˜ë©° CPUë¥¼ ì ìœ 
    - ë¸”ë¡œí‚¹ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ : ë½ì„ ì–»ì§€ ëª»í•˜ë©´, ëŒ€ê¸°íì—ì„œ ëŒ€ê¸°. CPUë¥¼ ë¹ ì ¸ë‚˜ê°€ë¯€ë¡œ ë³´ë‹¤ íš¨ìœ¨ì .

---

### #3. í€´ì¦ˆ

#### 1. ì„¸ë§ˆí¬ì–´ëŠ” ë°”ìœ ëŒ€ê¸°ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ì‘ì—…ì„ ë§ˆì¹œ í”„ë¡œì„¸ìŠ¤ê°€ wake_up ì‹ í˜¸ë¥¼ ë³´ëƒˆì„ ë•Œ, ëŒ€ê¸° ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„êµ¬ì—­ì— ë“¤ì–´ê°€ëŠ” ë°©ì‹ì´ë¼ ê·¸ë ‡ë‹¤. ì´ë•Œ ëŒ€ê¸° ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœëŠ” ë­ë¼ê³  ë¶€ë¥¼ê¹Œìš”?

#### 2. ë®¤í…ìŠ¤ì—ì„œ ì„ê³„êµ¬ì—­ì´ ì—¬ëŸ¬ê°œì¸ ê²½ìš°ì—ëŠ”, ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì‘ë™í• ê¹Œìš”?

1. ëª¨ë“  ì„ê³„êµ¬ì—­ì„ í•˜ë‚˜ì˜ ë®¤í…ìŠ¤ ë½ìœ¼ë¡œ ê´€ë¦¬í•´ì„œ, ë™ì‹œì— í•œ ëª…ë§Œ ì „ì²´ ìì›ì„ ì“¸ ìˆ˜ ìˆë„ë¡ í•œë‹¤.

2. ê° ì„ê³„êµ¬ì—­(ìì›)ë§ˆë‹¤ ë³„ë„ì˜ ë®¤í…ìŠ¤ ë½ì„ ìƒì„±í•´ì„œ, ìì›ë³„ë¡œ í•œ ëª…ë§Œ ì ‘ê·¼í•˜ë„ë¡ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.

3. ë®¤í…ìŠ¤ëŠ” ì„ê³„êµ¬ì—­ì´ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°ë¥¼ ì•„ì˜ˆ ê´€ë¦¬í•  ìˆ˜ ì—†ë‹¤.

4. ì—¬ëŸ¬ ì„ê³„êµ¬ì—­ì— ë™ì‹œì— ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ìƒí•œì„ ì„ ì •í•´ë†“ê³  ê·¸ ìƒí•œì„ ì´ ì°¼ì„ ë•Œ lockì„ ê±°ëŠ” ë°©ì‹ìœ¼ë¡œ í•œë‹¤.
